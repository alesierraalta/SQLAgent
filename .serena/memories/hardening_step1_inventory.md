Inventario rápido (step 1 hardening)
- Estructura src: validators/sql_validator.py (constantes DANGEROUS_COMMANDS, ALLOWED_FUNCTIONS; clase SQLValidator), agents/sql_agent.py (create_sql_agent, execute_query, _generate_system_prompt, _classify_query_complexity, _parse_streaming_chunk), utils/database.py (get_db_engine, get_db_connection, test_connection, dispose_engine, _sanitize_url). CLI: src/cli.py con comandos query/schema/validate_sql/history/stats/test_connection y helpers (_format_query_result, etc.).
- Tests presentes: test_validator, test_function_validation, test_error_patterns, test_agent, test_cli, test_database, test_history, test_ml_classifier, test_persistent_cache, test_schema_ttl, test_telemetry.
- Patrón de búsqueda peligroso: DML/DDL en sql_validator (DROP/INSERT/UPDATE/DELETE), referencias en agent (prompt: SOLO SELECT, prohíbe DROP/INSERT/UPDATE/DELETE/ALTER/CREATE/TRUNCATE), exceptions (mensaje comando peligroso), error_recovery pattern match SELECT/WITH/INSERT/UPDATE/DELETE/CREATE/ALTER/DROP/EXPLAIN.
- Timeout: sql_agent usa QUERY_TIMEOUT env (default 30) antes de ejecutar; cli busca 'timeout' en error_msg; error_recovery menciona 'timeout'.
- Próximos puntos de lectura focal: cuerpos de SQLValidator (validación real, extracción de tablas, prohibición de multi-statement), agent.execute_query y create_sql_agent (tool_choice, retries, prompt), utils/database (timeout enforcement real vs solo env var), error_recovery.
- Pendiente: confirmar enforcement real de read-only (DB user) y limit de rows; validar detección de comentarios/multi-statement.